# 杂货铺

## 死信队列

死信队列（Dead Letter Queue）：没有被及时消费的消息存放的队列。

消息没有被及时消费有以下几点原因：

1. 消息被拒绝并且不再重新投递 requeue=false
2. 消息超时未消费 TTL（time-to-live）
3. 达到最大队列长度

消息变成死信后，会被重新投递（publish）到另一个交换机上（Exchange），这个交换机往往被称为 DLX（dead-letter-exchange）“死信交换机”，然后交换机根据绑定规则转发到对应的队列上，监听该队列就可以被重新消费。

生产者 --> 发送消息 --> 交换机 --> 队列 --> 变成死信队列 --> DLX 交换机 --> 队列 --> 监听 --> 消费者

## MQ 消息队列的技术应用

1. 解耦

解耦是消息队列要解决的最本质问题。

2. 最终一致性

最终一致性指的是两个系统的状态保持一致，要么都成功，要么都失败。
最终一致性不是消息队列的必备特性，但确实可以依靠消息队列来做最终一致性的事情。

3. 广播

消息队列的基本功能之一是进行广播。有了消息队列，我们只需要关心消息是否送达了队列，至于谁希望订阅，是下游的事情，无疑极大地减少了开发和联调的工作量。

4. 错峰与流控

典型的使用场景就是秒杀业务用于流量削峰场景。
